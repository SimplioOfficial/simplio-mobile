<sio-page class="swap-page" actionPlaceholder=" {{ $.SEARCH_WALLET | translate }}" (refreshed)="doRefresh($event)"
  [hasHeader]="true" *ngIf="!(isLoadingInit$ | async); else initLoadingRef">
  <ng-template #headerTemplate>
    <div class="header-container">
      <h3>{{ $.TRADE | translate }}</h3>
      <sio-round-button (click)="openSettings()">
        <ion-icon name="person-outline"></ion-icon>
      </sio-round-button>
      <div *ngIf="notificationCount > 0" class="notification-count" (click)="openSettings()">
        <p>{{ notificationCount }}</p>
      </div>
    </div>
  </ng-template>

  <!-- tab sections   -->
  <ion-segment mode="md" value="home" scrollable="true" scrollbar="false"
    swipe-gesture="true" [(ngModel)]="segment" slot="dash">
    <ion-segment-button value="swaps">
      <ion-label>{{ $.SWAPS | translate }}</ion-label>
    </ion-segment-button>

    <ion-segment-button value="purchases">
      <ion-label>{{ $.PURCHASES | translate }}</ion-label>
    </ion-segment-button>

    <ion-segment-button value="staking">
      <ion-label>{{ $.STAKING | translate }}</ion-label>
    </ion-segment-button>
  </ion-segment>

  <ng-container *ngIf="isEmpty$ | async; else isEmptyRef">
    <ng-container *ngIf="pendingSwaps$ | async as pendingSwaps">

      <!-- Swaps tab   -->
      <div [ngSwitch]="segment">
        <ion-grid *ngSwitchCase="'swaps'">
          <section *ngIf="!!pendingSwaps.length" class="active tab-container">
            <header class="section-header">
              <span class="section-title">{{ $.ACTIVE_SWAPS | translate }}</span>
            </header>
            <ion-slides [options]="slideOpts">
              <ion-slide *ngFor="let tx of pendingSwaps">
                <sio-swap-pending-item (click)="openDetail(tx)" [transaction]="tx"
                  [translations]="swapStatusTranslations" [issue-text]="$.TRANSACTION_DETAIL | translate">
                </sio-swap-pending-item>
              </ion-slide>
            </ion-slides>
          </section>
          <ng-container *ngIf="swapHistory$ | async as swapHistory">
            <section class="history" *ngIf="!!swapHistory.length">
              <header class="section-header">
                <p class="title section-title">{{ $.COMPLETED_SWAPS | translate }}</p>
              </header>
              <sio-swap-item *ngFor="let tx of swapHistory" [transaction]="tx" [translations]="swapStatusTranslations"
                [currency]="currency" [locale]="locale" [mode]="mode" [address-names]="addressNames$ | async"
                (click)="openDetail(tx)"></sio-swap-item>
            </section>


            <ion-infinite-scroll #infiniteScroll *ngIf="canLoad$ | async; else spacer" threshold="84px"
              (ionInfinite)="onInfiniteScroll()">
              <ion-infinite-scroll-content [loadingSpinner]="null">
                <sio-loading-transaction-item *ngIf="isLoadingHistory$ | async"></sio-loading-transaction-item>
              </ion-infinite-scroll-content>
            </ion-infinite-scroll>
          </ng-container>
          <ng-template #isEmptyRef>
            <section class="empty__transactions">
              <p>{{ $.NO_TRANSACTIONS | translate }}</p>
            </section>
          </ng-template>
        </ion-grid>

        <!-- Purchase tab   -->
        <ion-grid *ngSwitchCase="'purchases'">
          <section #transactionsElem class="history tab-container" *ngIf="dummytx$ | async as txs">
            <header class="section-header">
              <p class="section-title">{{ $.HISTORY | translate }}</p>
            </header>
            <sio-purchase-item *ngFor="let tx of txs" [transaction]="tx" [locale]="locale"
              [unconfirmed-message]="$.UNCONFIRMED | translate" (click)="openTransaction(tx)"></sio-purchase-item>
          </section>
        </ion-grid>

        <!-- Staking tab   -->
        <ion-grid *ngSwitchCase="'staking'">
          <ng-container *ngIf="stakingWalletList$ | async as stakingList">
            <section class="tab-container">
              <ng-container *ngFor="let s of stakingList">
                <sio-stake-item 
                  *ngIf="walletInfo(s.contractAddress) as wallet"
                  [wallet]="wallet" 
                  [staked]="s.amount"
                  [earned]="calculateEarn(s, walletInfo(s.contractAddress))" 
                  [is-token]="isToken(wallet.type)"
                  [token-id]="tokenId(wallet.type)"
                  (click)="openStakeDetails(s, walletInfo(s.contractAddress))">
                  <!-- <sio-embeded-chart [dataset]="[130, 180, 218, 190, 300, 330, 580, 618, 290, 300, 130]"></sio-embeded-chart> -->
                </sio-stake-item>
              </ng-container>
            </section>
          </ng-container>
        </ion-grid>
      </div>
    </ng-container>

    <ng-template #spacer>
      <div class="spacer"></div>
    </ng-template>
  </ng-container>
</sio-page>

<ng-template #initLoadingRef>
  <section class="loading">
    <sio-spinner></sio-spinner>
  </section>
</ng-template>
